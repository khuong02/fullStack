{"ast":null,"code":"var _jsxFileName = \"E:\\\\MERN stack project\\\\fullStack\\\\client\\\\src\\\\auth\\\\form\\\\Edit.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { Link, useParams } from \"react-router-dom\";\nimport axios from \"axios\";\nimport { ErrShow, SuccessShow } from \"../notification/Notification\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst initialState = {\n  productItem: {},\n  err: \"\",\n  success: \"\"\n};\nconst changeValue = {\n  species: \"\",\n  nameProduct: \"\",\n  errChange: \"\",\n  successChange: \"\"\n};\n\nconst Edit = () => {\n  _s();\n\n  const {\n    id\n  } = useParams();\n  const [product, setProduct] = useState(initialState);\n  const [change, setChange] = useState(changeValue);\n  const [image, setImage] = useState(false);\n  const [cloudinary, setCloundinary] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const {\n    species,\n    nameProduct,\n    errChange,\n    successChange\n  } = change;\n  const {\n    productItem,\n    err,\n    success\n  } = product;\n  useEffect(() => {\n    const getData = async () => {\n      try {\n        if (id) {\n          const res = await axios.post(\"/user/edit\", {\n            id\n          });\n          console.log(res);\n          if (!res) return setProduct({ ...productItem,\n            err: \"Sản phẩm không tồn tại.\",\n            success\n          });\n          setProduct({\n            productItem: res.data.product[0],\n            err: \"\",\n            success: \"\"\n          });\n        }\n      } catch (err) {\n        err.response.data.msg && setProduct({ ...product,\n          err: err.response.data.msg,\n          success: \"\"\n        });\n      }\n    };\n\n    getData();\n  }, [id]);\n\n  const handleChangeInput = e => {\n    const {\n      name,\n      value\n    } = e.target;\n    setChange({ ...change,\n      [name]: value,\n      errChange: \"\",\n      successChange: \"\"\n    });\n  };\n\n  const changeImageProduct = async e => {\n    e.preventDefault();\n\n    try {\n      const file = e.target.files[0];\n      let formData = new FormData();\n      formData.append(\"image\", file);\n      setLoading(true);\n      const res = await axios.post(`/user/upload_product`, formData, {\n        headers: {\n          \"content-Type\": \"multipart/form-data\"\n        }\n      });\n      setImage(res.data.image);\n      setCloundinary(res.data.cloudinary_id);\n      setLoading(false);\n    } catch (err) {\n      err.response.data.msg && setChange({ ...change,\n        errChange: err.response.data.msg,\n        successChange: \"\"\n      });\n      console.log(err);\n    }\n  };\n\n  const handleUpdate = async (e, image) => {\n    e.preventDefault();\n\n    if (image !== productItem.image) {\n      try {\n        const oldCloudinary = productItem.cloudinary;\n\n        if (id) {\n          await axios.patch(`/user/edit/${id}`, {\n            nameProduct: nameProduct ? nameProduct : productItem.name,\n            species: species ? species : productItem.species,\n            cloudinaryNew: cloudinary ? cloudinary : oldCloudinary,\n            image,\n            oldCloudinary\n          });\n          window.location.href = `/user/product/${id}`;\n        }\n      } catch (err) {\n        err.response.data.msg && setChange({ ...change,\n          errChange: err.response.data.msg,\n          successChange: \"\"\n        });\n      }\n    } else {\n      try {\n        const oldCloudinary = productItem.cloudinary;\n\n        if (id) {\n          await axios.patch(`/user/edit/${id}`, {\n            nameProduct,\n            species,\n            cloudinaryNew: cloudinary ? cloudinary : oldCloudinary,\n            image,\n            oldCloudinary\n          });\n          window.location.href = `/user/product/${id}`;\n        }\n      } catch (err) {\n        err.response.data.msg && setChange({ ...change,\n          errChange: err.response.data.msg,\n          successChange: \"\"\n        });\n      }\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [err && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"errProduct\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: err\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Link, {\n        to: \"\",\n        children: \"Quay v\\u1EC1 trang ch\\u1EE7!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 9\n    }, this), !err && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"box-edit\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"box-edit-item\",\n        children: [loading && /*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"fas fa-spinner fa-spin loadingEdit\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: [/*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"fas fa-camera\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 157,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            name: \"image\",\n            id: \"file_up\",\n            onChange: changeImageProduct\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 158,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n          src: image ? image : productItem.image,\n          alt: \"\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: productItem.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-upload\",\n        children: [errChange && ErrShow(errChange), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-edit-item\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"species\",\n            children: \"Lo\\u1EA1i s\\u1EA3n ph\\u1EA9m\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 171,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            id: \"species\",\n            type: \"text\",\n            name: \"species\",\n            value: species,\n            placeholder: \"Nh\\u1EADp lo\\u1EA1i s\\u1EA3n ph\\u1EA9m...\",\n            onChange: handleChangeInput\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-edit-item\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"name\",\n            children: \"T\\xEAn s\\u1EA3n ph\\u1EA9m\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 182,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            id: \"name\",\n            type: \"text\",\n            name: \"nameProduct\",\n            value: nameProduct,\n            placeholder: \"Nh\\u1EADp t\\xEAn s\\u1EA3n ph\\u1EA9m...\",\n            onChange: handleChangeInput\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 183,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: e => {\n            if (image) {\n              handleUpdate(e, image);\n            } else {\n              handleUpdate(e, productItem.image);\n            }\n          },\n          children: \"Update!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true);\n};\n\n_s(Edit, \"EHhoyEBupvNq4RsGu6ABGJ2cHIU=\", false, function () {\n  return [useParams];\n});\n\n_c = Edit;\nexport default Edit;\n\nvar _c;\n\n$RefreshReg$(_c, \"Edit\");","map":{"version":3,"sources":["E:/MERN stack project/fullStack/client/src/auth/form/Edit.js"],"names":["React","useState","useEffect","Link","useParams","axios","ErrShow","SuccessShow","initialState","productItem","err","success","changeValue","species","nameProduct","errChange","successChange","Edit","id","product","setProduct","change","setChange","image","setImage","cloudinary","setCloundinary","loading","setLoading","getData","res","post","console","log","data","response","msg","handleChangeInput","e","name","value","target","changeImageProduct","preventDefault","file","files","formData","FormData","append","headers","cloudinary_id","handleUpdate","oldCloudinary","patch","cloudinaryNew","window","location","href"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { Link, useParams } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport { ErrShow, SuccessShow } from \"../notification/Notification\";\r\n\r\nconst initialState = {\r\n  productItem: {},\r\n  err: \"\",\r\n  success: \"\",\r\n};\r\n\r\nconst changeValue = {\r\n  species: \"\",\r\n  nameProduct: \"\",\r\n  errChange: \"\",\r\n  successChange: \"\",\r\n};\r\n\r\nconst Edit = () => {\r\n  const { id } = useParams();\r\n  const [product, setProduct] = useState(initialState);\r\n  const [change, setChange] = useState(changeValue);\r\n  const [image, setImage] = useState(false);\r\n  const [cloudinary, setCloundinary] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const { species, nameProduct, errChange, successChange } = change;\r\n\r\n  const { productItem, err, success } = product;\r\n\r\n  useEffect(() => {\r\n    const getData = async () => {\r\n      try {\r\n        if (id) {\r\n          const res = await axios.post(\"/user/edit\", { id });\r\n          console.log(res);\r\n          if (!res)\r\n            return setProduct({\r\n              ...productItem,\r\n              err: \"Sản phẩm không tồn tại.\",\r\n              success,\r\n            });\r\n\r\n          setProduct({\r\n            productItem: res.data.product[0],\r\n            err: \"\",\r\n            success: \"\",\r\n          });\r\n        }\r\n      } catch (err) {\r\n        err.response.data.msg &&\r\n          setProduct({ ...product, err: err.response.data.msg, success: \"\" });\r\n      }\r\n    };\r\n    getData();\r\n  }, [id]);\r\n\r\n  const handleChangeInput = (e) => {\r\n    const { name, value } = e.target;\r\n\r\n    setChange({ ...change, [name]: value, errChange: \"\", successChange: \"\" });\r\n  };\r\n\r\n  const changeImageProduct = async (e) => {\r\n    e.preventDefault();\r\n    try {\r\n      const file = e.target.files[0];\r\n      let formData = new FormData();\r\n      formData.append(\"image\", file);\r\n      setLoading(true);\r\n\r\n      const res = await axios.post(`/user/upload_product`, formData, {\r\n        headers: {\r\n          \"content-Type\": \"multipart/form-data\",\r\n        },\r\n      });\r\n\r\n      setImage(res.data.image);\r\n      setCloundinary(res.data.cloudinary_id);\r\n      setLoading(false);\r\n    } catch (err) {\r\n      err.response.data.msg &&\r\n        setChange({\r\n          ...change,\r\n          errChange: err.response.data.msg,\r\n          successChange: \"\",\r\n        });\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  const handleUpdate = async (e, image) => {\r\n    e.preventDefault();\r\n\r\n    if (image !== productItem.image) {\r\n      try {\r\n        const oldCloudinary = productItem.cloudinary;\r\n\r\n        if (id) {\r\n          await axios.patch(`/user/edit/${id}`, {\r\n            nameProduct: nameProduct ? nameProduct : productItem.name,\r\n            species: species ? species : productItem.species,\r\n            cloudinaryNew: cloudinary ? cloudinary : oldCloudinary,\r\n            image,\r\n            oldCloudinary,\r\n          });\r\n\r\n          window.location.href = `/user/product/${id}`;\r\n        }\r\n      } catch (err) {\r\n        err.response.data.msg &&\r\n          setChange({\r\n            ...change,\r\n            errChange: err.response.data.msg,\r\n            successChange: \"\",\r\n          });\r\n      }\r\n    } else {\r\n      try {\r\n        const oldCloudinary = productItem.cloudinary;\r\n\r\n        if (id) {\r\n          await axios.patch(`/user/edit/${id}`, {\r\n            nameProduct,\r\n            species,\r\n            cloudinaryNew: cloudinary ? cloudinary : oldCloudinary,\r\n            image,\r\n            oldCloudinary,\r\n          });\r\n\r\n          window.location.href = `/user/product/${id}`;\r\n        }\r\n      } catch (err) {\r\n        err.response.data.msg &&\r\n          setChange({\r\n            ...change,\r\n            errChange: err.response.data.msg,\r\n            successChange: \"\",\r\n          });\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {err && (\r\n        <div className=\"errProduct\">\r\n          <h1>{err}</h1>\r\n          <Link to=\"\">Quay về trang chủ!</Link>\r\n        </div>\r\n      )}\r\n      {!err && (\r\n        <div className=\"box-edit\">\r\n          <div className=\"box-edit-item\">\r\n            {loading && <i className=\"fas fa-spinner fa-spin loadingEdit\"></i>}\r\n            <span>\r\n              <i className=\"fas fa-camera\"></i>\r\n              <input\r\n                type=\"file\"\r\n                name=\"image\"\r\n                id=\"file_up\"\r\n                onChange={changeImageProduct}\r\n              />\r\n            </span>\r\n            <img src={image ? image : productItem.image} alt=\"\" />\r\n            <p>{productItem.name}</p>\r\n          </div>\r\n          <div className=\"form-upload\">\r\n            {errChange && ErrShow(errChange)}\r\n            <div className=\"form-edit-item\">\r\n              <label htmlFor=\"species\">Loại sản phẩm</label>\r\n              <input\r\n                id=\"species\"\r\n                type=\"text\"\r\n                name=\"species\"\r\n                value={species}\r\n                placeholder=\"Nhập loại sản phẩm...\"\r\n                onChange={handleChangeInput}\r\n              />\r\n            </div>\r\n            <div className=\"form-edit-item\">\r\n              <label htmlFor=\"name\">Tên sản phẩm</label>\r\n              <input\r\n                id=\"name\"\r\n                type=\"text\"\r\n                name=\"nameProduct\"\r\n                value={nameProduct}\r\n                placeholder=\"Nhập tên sản phẩm...\"\r\n                onChange={handleChangeInput}\r\n              />\r\n            </div>\r\n            <button\r\n              onClick={(e) => {\r\n                if (image) {\r\n                  handleUpdate(e, image);\r\n                } else {\r\n                  handleUpdate(e, productItem.image);\r\n                }\r\n              }}\r\n            >\r\n              Update!\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Edit;\r\n"]},"metadata":{},"sourceType":"module"}